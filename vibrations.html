<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceramic Color Vibration Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e1e2e, #2d2d44);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .color-selection-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .color-selection-section h2 {
            text-align: center;
            margin-bottom: 10px;
            color: #4ecdc4;
            font-size: 1.8rem;
        }

        .selection-description {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.8;
            font-size: 1.1rem;
        }

        .color-categories {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .color-category h3 {
            margin-bottom: 15px;
            color: #4ecdc4;
            font-size: 1.3rem;
            text-align: center;
        }

        .color-swatches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .color-swatch-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .color-swatch-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .color-swatch-item.selected {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }

        .color-swatch-small {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .color-swatch-label {
            font-size: 0.6rem;
            text-align: center;
            font-weight: bold;
            line-height: 1.2;
            opacity: 0.8;
        }

        .color-pair-count {
            font-size: 0.6rem;
            color: #4ecdc4;
            font-weight: bold;
            margin-top: 2px;
        }

        .selected-color-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid #4ecdc4;
        }

        .selected-color-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .selected-color-swatch {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .selected-color-details h4 {
            margin-bottom: 5px;
            color: #4ecdc4;
            font-size: 1.2rem;
        }

        .selected-color-details p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .clear-selection-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .clear-selection-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        @media (max-width: 768px) {
            .color-categories {
                grid-template-columns: 1fr;
            }
            
            .selected-color-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        .controls-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .control-group.centered {
            justify-self: center;
            grid-column: 1 / -1;
        }

        .control-group label {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .threshold-slider {
            width: 200px;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .threshold-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .threshold-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4ecdc4;
            min-width: 60px;
            text-align: center;
        }

        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #4ecdc4;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4ecdc4;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .results-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.5rem;
            color: #4ecdc4;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .sort-controls select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .color-pairs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .color-pair-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .pair-type-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .pair-type-badge.underglaze-underglaze {
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            color: white;
        }

        .pair-type-badge.underglaze-glaze {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
        }

        .color-pair-card:hover {
            transform: translateY(-5px);
            border-color: rgba(78, 205, 196, 0.5);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .color-pair-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            margin-top: 20px;
        }

        .vibration-score {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .color-pair-colors {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .color-item {
            flex: 1;
            text-align: center;
        }

        .color-swatch {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin: 0 auto 8px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .color-name {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .color-id {
            font-size: 0.8rem;
            opacity: 0.7;
            font-family: 'Courier New', monospace;
        }

        .vs-text {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4ecdc4;
        }

        .preview-button {
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .preview-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .link-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .link-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .preview-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .preview-section.active {
            display: block;
        }

        .preview-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #4ecdc4;
        }

        .lines-container {
            display: flex;
            flex-direction: column;
            gap: 0;
            max-width: 800px;
            margin: 0 auto;
        }

        .vibrating-line {
            height: 20px;
            transition: background-color 0.3s ease;
            border-radius: 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .controls-row {
                flex-direction: column;
                gap: 20px;
            }
            
            .color-pairs-grid {
                grid-template-columns: 1fr;
            }
            
            .results-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="color-selection-section">
            
            <div class="color-categories">
                <div class="color-category">
                    <h3>Underglazes</h3>
                    <div class="color-swatches-grid" id="underglazeSwatches">
                        <!-- Underglaze swatches will be generated here -->
                    </div>
                </div>
                <div class="color-category">
                    <h3>Glazes</h3>
                    <div class="color-swatches-grid" id="glazeSwatches">
                        <!-- Glaze swatches will be generated here -->
                    </div>
                </div>
                <div class="control-group centered">
                    <label for="thresholdSlider">Vibration Threshold</label>
                    <input type="range" id="thresholdSlider" class="threshold-slider" min="0" max="100" value="70">
                    <div class="threshold-value" id="thresholdValue">70</div>
                </div>
            </div>
            
            <div class="selected-color-info" id="selectedColorInfo" style="display: none;">
                <div class="selected-color-display">
                    <div class="selected-color-swatch" id="selectedColorSwatch"></div>
                    <div class="selected-color-details">
                        <h4 id="selectedColorName"></h4>
                        <p id="selectedColorId"></p>
                    </div>
                </div>
                <button id="clearSelection" class="clear-selection-btn">Clear Selection</button>
            </div>
        </div>

        <div class="preview-section" id="previewSection">
            <h3 class="preview-title">Preview: <span id="previewTitle"></span></h3>
            <div class="lines-container" id="previewLines">
                <!-- Preview lines will be generated here -->
            </div>
        </div>

        <div class="controls-section" style="display: none;">
            <div class="controls-row">
                
                <div class="stats" style="display: none;">
                    <div class="stat-item">
                        <div class="stat-value" id="totalPairs">0</div>
                        <div class="stat-label">Total Pairs</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="filteredPairs">0</div>
                        <div class="stat-label">Above Threshold</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="maxVibration">0</div>
                        <div class="stat-label">Max Vibration</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">
                <h2 class="results-title">Vibrating Color Pairs</h2>
                <div class="sort-controls">
                    <label for="filterSelect">Filter:</label>
                    <select id="filterSelect">
                        <option value="all">All Pairs</option>
                        <option value="underglaze-underglaze">Underglaze + Underglaze</option>
                        <option value="underglaze-glaze">Underglaze + Glaze</option>
                    </select>
                    <label for="sortSelect">Sort by:</label>
                    <select id="sortSelect">
                        <option value="vibration">Vibration Score</option>
                        <option value="name">Color Name</option>
                        <option value="id">Color ID</option>
                    </select>
                </div>
            </div>
            <div class="color-pairs-grid" id="colorPairsGrid">
                <div class="loading">Loading ceramic colors...</div>
            </div>
        </div>

        
    </div>

    <script>
        let ceramicColors = [];
        let allColorPairs = [];
        let filteredPairs = [];
        let currentPreview = null;
        let selectedColor = null;

        // Load ceramic colors from JSON file
        async function loadCeramicColors() {
            try {
                const response = await fetch('colors.json');
                const data = await response.json();
                
                // Combine glazes and underglazes, using underglazes as primary focus
                ceramicColors = [
                    ...data.underglazes.map(ug => ({
                        id: ug.id,
                        name: ug.name,
                        color: ug.left, // Using left color as primary
                        type: 'underglaze',
                        original: ug
                    })),
                    ...data.glazes.map(glaze => ({
                        id: glaze.id,
                        name: glaze.name,
                        color: glaze.color,
                        type: 'glaze',
                        original: glaze
                    }))
                ];
                
                calculateAllPairs();
                renderColorSwatches();
                updateDisplay();
            } catch (error) {
                console.error('Error loading ceramic colors:', error);
                document.getElementById('colorPairsGrid').innerHTML = 
                    '<div class="no-results">Error loading color data. Please check that colors.json is available.</div>';
            }
        }

        // Calculate vibration strength between two colors
        function calculateVibrationStrength(color1, color2) {
            const rgb1 = hexToRgb(color1);
            const rgb2 = hexToRgb(color2);
            
            if (!rgb1 || !rgb2) return 0;
            
            // Calculate Euclidean distance in RGB space
            const distance = Math.sqrt(
                Math.pow(rgb1.r - rgb2.r, 2) +
                Math.pow(rgb1.g - rgb2.g, 2) +
                Math.pow(rgb1.b - rgb2.b, 2)
            );
            
            // Normalize to 0-100 scale (max distance in RGB is ~441)
            const normalizedDistance = Math.min((distance / 441) * 100, 100);
            
            // Calculate complementary relationship bonus
            const complementary = calculateComplementary(color1);
            const complementaryDistance = Math.sqrt(
                Math.pow(rgb1.r - (255 - rgb2.r), 2) +
                Math.pow(rgb1.g - (255 - rgb2.g), 2) +
                Math.pow(rgb1.b - (255 - rgb2.b), 2)
            );
            
            const complementaryBonus = Math.max(0, (441 - complementaryDistance) / 441 * 20);
            
            return Math.min(normalizedDistance + complementaryBonus, 100);
        }

        // Calculate all possible color pairs (underglaze-underglaze or underglaze-glaze only)
        function calculateAllPairs() {
            allColorPairs = [];
            
            // Separate underglazes and glazes
            const underglazes = ceramicColors.filter(color => color.type === 'underglaze');
            const glazes = ceramicColors.filter(color => color.type === 'glaze');
            
            // Compare underglaze to underglaze
            for (let i = 0; i < underglazes.length; i++) {
                for (let j = i + 1; j < underglazes.length; j++) {
                    const color1 = underglazes[i];
                    const color2 = underglazes[j];
                    const vibration = calculateVibrationStrength(color1.color, color2.color);
                    
                    allColorPairs.push({
                        color1,
                        color2,
                        vibration: Math.round(vibration),
                        id: `${color1.id}-${color2.id}`,
                        pairType: 'underglaze-underglaze'
                    });
                }
            }
            
            // Compare underglaze to glaze
            for (let i = 0; i < underglazes.length; i++) {
                for (let j = 0; j < glazes.length; j++) {
                    const color1 = underglazes[i];
                    const color2 = glazes[j];
                    const vibration = calculateVibrationStrength(color1.color, color2.color);
                    
                    allColorPairs.push({
                        color1,
                        color2,
                        vibration: Math.round(vibration),
                        id: `${color1.id}-${color2.id}`,
                        pairType: 'underglaze-glaze'
                    });
                }
            }
            
            // Sort by vibration strength (highest first)
            allColorPairs.sort((a, b) => b.vibration - a.vibration);
        }

        // Calculate pair count for a specific color
        function getPairCountForColor(colorId) {
            const threshold = parseInt(document.getElementById('thresholdSlider').value);
            const pairTypeFilter = document.getElementById('filterSelect').value;
            
            return allColorPairs.filter(pair => {
                const meetsThreshold = pair.vibration >= threshold;
                const meetsTypeFilter = pairTypeFilter === 'all' || pair.pairType === pairTypeFilter;
                const includesColor = pair.color1.id === colorId || pair.color2.id === colorId;
                
                return meetsThreshold && meetsTypeFilter && includesColor;
            }).length;
        }

        // Render color swatches
        function renderColorSwatches() {
            const underglazes = ceramicColors.filter(color => color.type === 'underglaze');
            const glazes = ceramicColors.filter(color => color.type === 'glaze');
            
            // Render underglaze swatches
            const underglazeContainer = document.getElementById('underglazeSwatches');
            underglazeContainer.innerHTML = underglazes.map(color => {
                const pairCount = getPairCountForColor(color.id);
                return `
                    <div class="color-swatch-item" data-color-id="${color.id}" onclick="selectColor('${color.id}')">
                        <div class="color-swatch-small" style="background-image: url('${color.original.image}')"></div>
                        <div class="color-pair-count">${pairCount} pairs</div>
                    </div>
                `;
            }).join('');
            
            // Render glaze swatches
            const glazeContainer = document.getElementById('glazeSwatches');
            glazeContainer.innerHTML = glazes.map(color => {
                const pairCount = getPairCountForColor(color.id);
                return `
                    <div class="color-swatch-item" data-color-id="${color.id}" onclick="selectColor('${color.id}')">
                        <div class="color-swatch-small" style="background-image: url('${color.original.image}')"></div>
                        <div class="color-pair-count">${pairCount} pairs</div>
                    </div>
                `;
            }).join('');
        }

        // Select a color
        function selectColor(colorId) {
            selectedColor = ceramicColors.find(color => color.id === colorId);
            
            // Update visual selection
            document.querySelectorAll('.color-swatch-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`[data-color-id="${colorId}"]`).classList.add('selected');
            
            // Update selected color info
            document.getElementById('selectedColorSwatch').style.backgroundImage = `url('${selectedColor.original.image}')`;
            document.getElementById('selectedColorName').textContent = selectedColor.name;
            document.getElementById('selectedColorId').textContent = `${selectedColor.id} (${selectedColor.type})`;
            document.getElementById('selectedColorInfo').style.display = 'flex';
            
            // Update display
            updateDisplay();
        }

        // Clear selection
        function clearSelection() {
            selectedColor = null;
            
            // Update visual selection
            document.querySelectorAll('.color-swatch-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Hide selected color info
            document.getElementById('selectedColorInfo').style.display = 'none';
            
            // Update display
            updateDisplay();
        }

        // Filter pairs based on threshold, pair type, and selected color
        function filterPairs() {
            const threshold = parseInt(document.getElementById('thresholdSlider').value);
            const pairTypeFilter = document.getElementById('filterSelect').value;
            
            filteredPairs = allColorPairs.filter(pair => {
                const meetsThreshold = pair.vibration >= threshold;
                const meetsTypeFilter = pairTypeFilter === 'all' || pair.pairType === pairTypeFilter;
                const meetsColorFilter = !selectedColor || 
                    pair.color1.id === selectedColor.id || 
                    pair.color2.id === selectedColor.id;
                
                return meetsThreshold && meetsTypeFilter && meetsColorFilter;
            });
        }

        // Update display
        function updateDisplay() {
            filterPairs();
            
            // Update stats
            document.getElementById('totalPairs').textContent = allColorPairs.length;
            document.getElementById('filteredPairs').textContent = filteredPairs.length;
            document.getElementById('maxVibration').textContent = 
                allColorPairs.length > 0 ? allColorPairs[0].vibration : 0;
            
            // Update threshold display
            document.getElementById('thresholdValue').textContent = 
                document.getElementById('thresholdSlider').value;
            
            // Update color swatches with new counts
            renderColorSwatches();
            
            // Re-apply selection if one is active
            if (selectedColor) {
                document.querySelector(`[data-color-id="${selectedColor.id}"]`).classList.add('selected');
            }
            
            // Render color pairs
            renderColorPairs();
        }

        // Render color pairs grid
        function renderColorPairs() {
            const grid = document.getElementById('colorPairsGrid');
            
            if (filteredPairs.length === 0) {
                grid.innerHTML = '<div class="no-results">No color pairs meet the current threshold</div>';
                return;
            }
            
            const sortBy = document.getElementById('sortSelect').value;
            let sortedPairs = [...filteredPairs];
            
            if (sortBy === 'name') {
                sortedPairs.sort((a, b) => a.color1.name.localeCompare(b.color1.name));
            } else if (sortBy === 'id') {
                sortedPairs.sort((a, b) => a.color1.id.localeCompare(b.color1.id));
            }
            
            grid.innerHTML = sortedPairs.map(pair => `
                <div class="color-pair-card" data-pair-id="${pair.id}">
                    <div class="pair-type-badge ${pair.pairType}">${pair.pairType.replace('-', ' + ')}</div>
                    <div class="color-pair-header">
                        <h4>${pair.color1.name} + ${pair.color2.name}</h4>
                        <div class="vibration-score">${pair.vibration}</div>
                    </div>
                    <div class="color-pair-colors">
                        <div class="color-item">
                            <div class="color-swatch" style="background-color: ${pair.color1.color}"></div>
                            <div class="color-name">${pair.color1.name}</div>
                            <div class="color-id">${pair.color1.id} (${pair.color1.type})</div>
                        </div>
                        <div class="vs-text">vs</div>
                        <div class="color-item">
                            <div class="color-swatch" style="background-color: ${pair.color2.color}"></div>
                            <div class="color-name">${pair.color2.name}</div>
                            <div class="color-id">${pair.color2.id} (${pair.color2.type})</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="preview-button" onclick="previewPair('${pair.id}')">
                            Preview Vibration
                        </button>
                        <button class="link-button" onclick="openInMainApp('${pair.id}')">
                            View in Main App
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Preview a color pair
        function previewPair(pairId) {
            const pair = allColorPairs.find(p => p.id === pairId);
            if (!pair) return;
            
            currentPreview = pair;
            
            // Update preview title
            document.getElementById('previewTitle').textContent = 
                `${pair.color1.name} + ${pair.color2.name} (${pair.vibration})`;
            
            // Generate preview lines
            const container = document.getElementById('previewLines');
            container.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const line = document.createElement('div');
                line.className = 'vibrating-line';
                line.style.backgroundColor = i % 2 === 0 ? pair.color1.color : pair.color2.color;
                line.style.height = '20px';
                line.style.marginBottom = '0px';
                container.appendChild(line);
            }
            
            // Show preview section
            document.getElementById('previewSection').classList.add('active');
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Open color pair in main app with truchet pattern
        function openInMainApp(pairId) {
            const pair = allColorPairs.find(p => p.id === pairId);
            if (!pair) return;
            
            // Determine which color should be background and which should be pattern
            // For underglaze-underglaze pairs, use first as background, second as pattern
            // For underglaze-glaze pairs, use underglaze as background, glaze as pattern
            let bgColor, bgColorName, patternColor, patternColorName;
            
            if (pair.pairType === 'underglaze-underglaze') {
                bgColor = pair.color1.color;
                bgColorName = `${pair.color1.name} (${pair.color1.id})`;
                patternColor = pair.color2.color;
                patternColorName = `${pair.color2.name} (${pair.color2.id})`;
            } else if (pair.pairType === 'underglaze-glaze') {
                bgColor = pair.color1.color; // underglaze as background
                bgColorName = `${pair.color1.name} (${pair.color1.id})`;
                patternColor = pair.color2.color; // glaze as pattern
                patternColorName = `${pair.color2.name} (${pair.color2.id})`;
            } else {
                // Fallback
                bgColor = pair.color1.color;
                bgColorName = `${pair.color1.name} (${pair.color1.id})`;
                patternColor = pair.color2.color;
                patternColorName = `${pair.color2.name} (${pair.color2.id})`;
            }
            
            // Generate URL with parameters
            const baseUrl = window.location.origin + '/index.html';
            const params = new URLSearchParams();
            
            params.set('pattern', 'truchet.svg');
            params.set('bgColor', bgColor);
            params.set('patternColor', patternColor);
            params.set('bgColorName', encodeURIComponent(bgColorName));
            params.set('patternColorName', encodeURIComponent(patternColorName));
            
            const url = `${baseUrl}?${params.toString()}`;
            
            // Open in new tab
            window.open(url, '_blank');
        }

        // Utility functions
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function calculateComplementary(hex) {
            const rgb = hexToRgb(hex);
            if (!rgb) return hex;
            return rgbToHex(255 - rgb.r, 255 - rgb.g, 255 - rgb.b);
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        // Event listeners
        document.getElementById('thresholdSlider').addEventListener('input', updateDisplay);
        document.getElementById('filterSelect').addEventListener('change', updateDisplay);
        document.getElementById('sortSelect').addEventListener('change', renderColorPairs);
        document.getElementById('clearSelection').addEventListener('click', clearSelection);

        // Initialize
        document.addEventListener('DOMContentLoaded', loadCeramicColors);
    </script>
</body>
</html>
